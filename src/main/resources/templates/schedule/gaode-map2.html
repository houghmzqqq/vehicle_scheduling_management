<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>物流公司车辆调度管理系统</title>
    <!-- Bootstrap Styles-->
    <link href="/assets/css/bootstrap.css" rel="stylesheet"/>
    <!-- FontAwesome Styles-->
    <link href="/assets/css/font-awesome.css" rel="stylesheet"/>
    <!-- Morris Chart Styles-->
    <link href="/assets/js/morris/morris-0.4.3.min.css" rel="stylesheet"/>
    <!-- Custom Styles-->
    <link href="/assets/css/custom-styles.css" rel="stylesheet"/>
    <!-- Google Fonts-->
    <link href='/assets/css/fonts-googleapis.css' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" href="/assets/js/Lightweight-Chart/cssCharts.css">
    <link rel="stylesheet" href="https://cache.amap.com/lbs/static/main.css"/>
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
    <!--<style type="text/css">-->
    <!--#panel {-->
    <!--position: fixed;-->
    <!--background-color: white;-->
    <!--max-height: 70%;-->
    <!--overflow-y: auto;-->
    <!--top: 200px;-->
    <!--right: 10px;-->
    <!--width: 280px;-->
    <!--}-->
    <!--</style>-->
    <style>
        #loadingTip {
            position: absolute;
            z-index: 9999;
            top: 0;
            left: 0;
            padding: 3px 10px;
            background: red;
            color: #fff;
            font-size: 14px;
        }
        .panel-body {
            align: center;
        }
        #toolBtn {
            width: 60%;
            /*height: 500px;*/
            position: absolute;
            right: 0;
            top: 50px;
            z-index: 12;
        }
    </style>
</head>

<body>
<div id="wrapper">
    <nav class="navbar navbar-default top-navbar" role="navigation" th:include="header :: top-navbar">
    </nav>
    <!--/. NAV TOP  -->
    <nav class="navbar-default navbar-side" role="navigation" th:include="sidebar :: navbar-side">
    </nav>
    <!-- /. NAV SIDE  -->
    <!--<div class="panel panel-default">-->
    <!--<div class="panel-body">-->
    <!--面板内容-->
    <!--</div>-->
    <!--</div>-->

    <div></div>
    <div id="page-wrapper">
        <div class="header">
            <ol class="breadcrumb">
                <li><a href="#">主页</a></li>
                <li><a href="#">调度申请 </a></li>
                <li class="active">整车调度</li>
            </ol>
        </div>
        <div class="panel-body" id="toolBtn">
            <button class="btn" onclick="checkPaths()">查看路径</button>
            <button class="btn" onclick="yjpz()">一键配载</button>
        </div>

        <div class="panel-body" id="map-window" style="height: 800px;">


        </div>

    </div>


    <!-- /. PAGE WRAPPER  -->
</div>
<!-- /. WRAPPER  -->
<!-- JS Scripts-->
<!-- jQuery Js -->
<script src="/assets/js/jquery-1.10.2.js"></script>
<!-- Bootstrap Js -->
<script src="/assets/js/bootstrap.min.js"></script>

<!-- Metis Menu Js -->
<script src="/assets/js/jquery.metisMenu.js"></script>

<script src="/assets/js/easypiechart.js"></script>
<script src="/assets/js/easypiechart-data.js"></script>

<script src="/assets/js/Lightweight-Chart/jquery.chart.js"></script>

<!-- Custom Js -->
<script src="/assets/js/custom-scripts.js"></script>

<!--<script src="http://webapi.amap.com/maps?v=1.4.6&key=4b3e05927c7a55aa1a6526687c38207a&callback=init&plugin=AMap.Driving"></script>-->
<script type="text/javascript"
        src="http://webapi.amap.com/maps?v=1.4.6&key=4b3e05927c7a55aa1a6526687c38207a&plugin=AMap.Driving&callback=init"></script>
<script src="https://webapi.amap.com/js/marker.js"></script>
<script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
<script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
<script type="text/javascript">

    //创建一个地图
    var map;
    window.init = function(){
        map = new AMap.Map('map-window', {
            center: [114.410185,23.101361],
            zoom: 6
        });
    }

    //点标注
    //    var marker;
    //    marker = new AMap.Marker({
    ////        icon: icon,
    //        position: "114.420433,23.069401".split(","),
    ////        offset: new AMap.Pixel(-12,-12),
    ////        zIndex: 101,
    //        title: "总公司",
    //        map: map
    //    });

    //构建信息窗体中显示的内容
    //    var info = [];
    //    info.push("<div style=\"padding:0px 0px 0px 0px;\"><b>高德软件有限公司</b><br/>");
    //    info.push("电话 : 010-84107000   邮编 : 100102<br/>");
    //    info.push("地址 : 北京市望京阜通东大街方恒国际中心A座16层</div></div><br>");
    //    infoWindow = new AMap.InfoWindow({
    //        content: info.join("<br>")  //使用默认信息窗体框样式，显示信息内容
    //    });
    //    infoWindow.open(map, [114.420433,23.069401]);

    //构造路线导航类
    var driving = new AMap.Driving({
        map: map,
//        panel: "panel"
    });
    // 根据起终点名称规划驾车导航路线
    //    driving.search([
    //        {keyword: '惠州市火车南站',city:'惠州'},
    //        {keyword: '广州市天河客运站',city:'广州'}
    //    ]);
    //通过坐标点规划路线
    //    driving.search([114.423933,23.058291],[113.342309,23.170892],[110.301129,21.150769],function (status,result) {
    //
    //    });

    function selectOne(address, city) {
        driving.search([
            {keyword: '惠州市火车南站', city: '惠州'},
            {keyword: address, city: city}
        ]);
    }

    var markers = [];
    $.getJSON("/schedule/getPois",function(rel){
        var marker;
        //公司地址设置一个marker
        marker = new AMap.Marker({
            icon: new AMap.Icon({
                image: "/assets/img/redTimg.png",
                imageSize: new AMap.Size(36,45)
            }),
            offset: new AMap.Pixel(-18,-34),
            position: [114.410185,23.101361],
            zindex:101,
            map:map
        });
        markers.push(marker);
        $.each(rel,function(i,poi){
            marker = new AMap.Marker({
                position:poi.split(","),
                zindex:101,
                map:map
            });
            markers.push(marker);
        });
        map.setFitView();
    });

    function checkPaths(){
        AMapUI.load(['ui/misc/PathSimplifier', 'lib/$'], function(PathSimplifier, $) {

            if (!PathSimplifier.supportCanvas) {
                alert('当前环境不支持 Canvas！');
                return;
            }

            //just some colors
            var colors = [
                "#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477", "#66aa00",
                "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc", "#e67300", "#8b0707",
                "#651067", "#329262", "#5574a6", "#3b3eac"
            ];

            var pathSimplifierIns = new PathSimplifier({
                zIndex: 100,
                //autoSetFitView:false,
                map: map, //所属的地图实例

                getPath: function(pathData, pathIndex) {

                    return pathData.route.paths.steps;
                },
                getHoverTitle: function(pathData, pathIndex, pointIndex) {

                    if (pointIndex >= 0) {
                        //point
                        return pathData.endPlace + '，点：' + pointIndex + '/' + pathData.route.paths.steps.length;
                    }

                    return pathData.endPlace + '，点数量' + pathData.route.paths.steps.length;
                },
                renderOptions: {
                    pathLineStyle: {
                        dirArrowStyle: true
                    },
                    getPathStyle: function(pathItem, zoom) {

                        var color = colors[pathItem.pathIndex % colors.length],
                            lineWidth = Math.round(2 * Math.pow(1.1, zoom - 3));

                        return {
                            pathLineStyle: {
                                strokeStyle: color,
                                lineWidth: lineWidth
                            },
                            pathLineSelectedStyle: {
                                lineWidth: lineWidth + 2
                            },
                            pathNavigatorStyle: {
                                fillStyle: color
                            }
                        };
                    }
                }
            });

            window.pathSimplifierIns = pathSimplifierIns;

            $('<div id="loadingTip">加载数据，请稍候...</div>').appendTo(document.getElementById("map-window"));

            $.getJSON('/schedule/getOrdersPath', function(d) {

                $('#loadingTip').remove();

                pathSimplifierIns.setData(d);

            });
        });
    }

    function yjpz(){
        $.getJSON("/schedule/yjsq",function(rel){
           alert("生成"+rel.count+"个调度申请，剩余"+rel.syCount+"个订单。");
        });
    }
</script>
<script type="text/javascript" src="https://webapi.amap.com/demos/js/liteToolbar.js"></script>

</body>

</html>